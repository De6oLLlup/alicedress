@model IEnumerable<alicedress.Models.Product>
@{
    ViewData["Title"] = "Управление товарами";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a asp-area="Admin" asp-controller="Dashboard" asp-action="Index">Дашборд</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Товары</li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="h3">Управление товарами</h1>
                <a asp-area="Admin" asp-controller="Products" asp-action="Create" class="btn btn-success">
                    <i class="bi bi-plus-circle"></i> Добавить товар
                </a>
            </div>
        </div>
    </div>

    <!-- Фильтры -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">Фильтры и поиск</h6>
                </div>
                <div class="card-body">
                    <form method="get" class="row g-3">
                        <div class="col-md-4">
                            <input type="text" name="search" class="form-control"
                                   placeholder="Поиск по названию, артикулу..."
                                   value="@ViewBag.Search">
                        </div>
                        <div class="col-md-3">
                            <select name="category" class="form-select">
                                <option value="">Все категории</option>
                                @if (ViewBag.Categories != null)
                                {
                                    foreach (var category in ViewBag.Categories)
                                    {
                                        <option value="@category" selected="@(ViewBag.SelectedCategory == category)">
                                            @category
                                        </option>
                                    }
                                }
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="bi bi-funnel"></i> Применить
                            </button>
                        </div>
                        <div class="col-md-2">
                            <a asp-area="Admin" asp-controller="Products" asp-action="Index"
                               class="btn btn-outline-secondary w-100">
                                <i class="bi bi-x-circle"></i> Сбросить
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Статистика -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="alert alert-info">
                <div class="row">
                    <div class="col-md-3">
                        <strong>Всего товаров:</strong> @ViewBag.TotalItems
                    </div>
                    <div class="col-md-3">
                        <strong>Текущая страница:</strong> @ViewBag.CurrentPage из @ViewBag.TotalPages
                    </div>
                    <div class="col-md-3">
                        @if (!string.IsNullOrEmpty(ViewBag.SelectedCategory as string))
                        {
                            <strong>Категория:</strong> 
                            @ViewBag.SelectedCategory
                        }
                    </div>
                    <div class="col-md-3">
                        @if (!string.IsNullOrEmpty(ViewBag.Search as string))
                        {
                            <strong>Поиск:</strong> 
                            @ViewBag.Search
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Таблица товаров -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    @if (!Model.Any())
                    {
                        <div class="text-center py-5">
                            <i class="bi bi-box display-1 text-muted"></i>
                            <h3 class="mt-3">Товары не найдены</h3>
                            <p class="text-muted">Попробуйте изменить параметры поиска</p>
                        </div>
                    }
                    else
                    {
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Изображение</th>
                                        <th>Название</th>
                                        <th>Категория</th>
                                        <th>Цена</th>
                                        <th>Остаток</th>
                                        <th>Статус</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var product in Model)
                                    {
                                        <tr>
                                            <td>@product.Id</td>
                                            <td>
                                                @if (product.Images.Any())
                                                {
                                                    <img src="@product.Images.First().ImageUrl"
                                                         class="img-thumbnail"
                                                         style="width: 60px; height: 60px; object-fit: cover;"
                                                         alt="@product.Name">
                                                }
                                                else
                                                {
                                                    <div class="bg-light rounded d-flex align-items-center justify-content-center"
                                                         style="width: 60px; height: 60px;">
                                                        <i class="bi bi-image text-muted"></i>
                                                    </div>
                                                }
                                            </td>
                                            <td>
                                                <strong>@product.Name</strong>
                                                @if (product.IsBestseller)
                                                {
                                                    <span class="badge bg-danger ms-1">Бестселлер</span>
                                                }
                                                <br>
                                                <small class="text-muted">@product.Article</small>
                                            </td>
                                            <td>@product.Category</td>
                                            <td>@product.Price.ToString("N0") ₽</td>
                                            <td>
                                                <span class="@(product.StockQuantity < 10 ? "text-danger fw-bold" : "")">
                                                    @product.StockQuantity шт
                                                </span>
                                            </td>
                                            <td>
                                                @if (product.IsActive)
                                                {
                                                    <span class="badge bg-success">Активен</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-secondary">Не активен</span>
                                                }
                                            </td>
                                            <td>
                                                <div class="btn-group btn-group-sm" role="group">
                                                    <a asp-area="Admin" asp-controller="Products" asp-action="Details"
                                                       asp-route-id="@product.Id" class="btn btn-info">
                                                        <i class="bi bi-eye"></i>
                                                    </a>
                                                    <a asp-area="Admin" asp-controller="Products" asp-action="Edit"
                                                       asp-route-id="@product.Id" class="btn btn-warning">
                                                        <i class="bi bi-pencil"></i>
                                                    </a>
                                                    <a asp-area="Admin" asp-controller="Products" asp-action="Delete"
                                                       asp-route-id="@product.Id" class="btn btn-danger">
                                                        <i class="bi bi-trash"></i>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>

                        <!-- Пагинация -->
                        @if (ViewBag.TotalPages > 1)
                        {
                            <nav aria-label="Навигация по страницам" class="mt-4">
                                <ul class="pagination justify-content-center">
                                    @if (ViewBag.CurrentPage > 1)
                                    {
                                        <li class="page-item">
                                            <a class="page-link"
                                               href="@Url.Action("Index", new { page = ViewBag.CurrentPage - 1, search = ViewBag.Search, category = ViewBag.SelectedCategory })">
                                                <i class="bi bi-chevron-left"></i> Назад
                                            </a>
                                        </li>
                                    }

                                    @for (int i = 1; i <= ViewBag.TotalPages; i++)
                                    {
                                        <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                                            <a class="page-link"
                                               href="@Url.Action("Index", new { page = i, search = ViewBag.Search, category = ViewBag.SelectedCategory })">
                                                @i
                                            </a>
                                        </li>
                                    }

                                    @if (ViewBag.CurrentPage < ViewBag.TotalPages)
                                    {
                                        <li class="page-item">
                                            <a class="page-link"
                                               href="@Url.Action("Index", new { page = ViewBag.CurrentPage + 1, search = ViewBag.Search, category = ViewBag.SelectedCategory })">
                                                Вперед <i class="bi bi-chevron-right"></i>
                                            </a>
                                        </li>
                                    }
                                </ul>
                            </nav>
                        }
                    }
                </div>
            </div>
        </div>
    </div>
</div>